(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/template/crop/crop"],{"0e65":function(t,a,e){"use strict";e.r(a);var o=e("dd7a"),i=e.n(o);for(var c in o)"default"!==c&&function(t){e.d(a,t,function(){return o[t]})}(c);a["default"]=i.a},"5d3e":function(t,a,e){"use strict";var o=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("view",{staticClass:"container"},[e("view",{staticClass:"page-body uni-content-info"},[e("view",{staticClass:"cropper-content"},[t.isShowImg?e("view",{staticClass:"uni-corpper",style:"width:"+t.cropperInitW+"px;height:"+t.cropperInitH+"px;background:#000"},[e("view",{staticClass:"uni-corpper-content",style:"width:"+t.cropperW+"px;height:"+t.cropperH+"px;left:"+t.cropperL+"px;top:"+t.cropperT+"px"},[e("image",{style:"width:"+t.cropperW+"px;height:"+t.cropperH+"px",attrs:{src:t.imageSrc}}),e("view",{staticClass:"uni-corpper-crop-box",style:"left:"+t.cutL+"px;top:"+t.cutT+"px;right:"+t.cutR+"px;bottom:"+t.cutB+"px",attrs:{eventid:"a881305a-9"},on:{touchstart:function(a){a.stopPropagation(),t.contentStartMove(a)},touchmove:function(a){a.stopPropagation(),t.contentMoveing(a)},touchend:function(a){a.stopPropagation(),t.contentTouchEnd(a)}}},[e("view",{staticClass:"uni-cropper-view-box"},[e("view",{staticClass:"uni-cropper-dashed-h"}),e("view",{staticClass:"uni-cropper-dashed-v"}),e("view",{staticClass:"uni-cropper-line-t",attrs:{"data-drag":"top",eventid:"a881305a-0"},on:{touchstart:function(a){a.stopPropagation(),t.dragStart(a)},touchmove:function(a){a.stopPropagation(),t.dragMove(a)}}}),e("view",{staticClass:"uni-cropper-line-r",attrs:{"data-drag":"right",eventid:"a881305a-1"},on:{touchstart:function(a){a.stopPropagation(),t.dragStart(a)},touchmove:function(a){a.stopPropagation(),t.dragMove(a)}}}),e("view",{staticClass:"uni-cropper-line-b",attrs:{"data-drag":"bottom",eventid:"a881305a-2"},on:{touchstart:function(a){a.stopPropagation(),t.dragStart(a)},touchmove:function(a){a.stopPropagation(),t.dragMove(a)}}}),e("view",{staticClass:"uni-cropper-line-l",attrs:{"data-drag":"left",eventid:"a881305a-3"},on:{touchstart:function(a){a.stopPropagation(),t.dragStart(a)},touchmove:function(a){a.stopPropagation(),t.dragMove(a)}}}),e("view",{staticClass:"uni-cropper-point point-t",attrs:{"data-drag":"top",eventid:"a881305a-4"},on:{touchstart:function(a){a.stopPropagation(),t.dragStart(a)},touchmove:function(a){a.stopPropagation(),t.dragMove(a)}}}),e("view",{staticClass:"uni-cropper-point point-tr",attrs:{"data-drag":"topTight"}}),e("view",{staticClass:"uni-cropper-point point-r",attrs:{"data-drag":"right",eventid:"a881305a-5"},on:{touchstart:function(a){a.stopPropagation(),t.dragStart(a)},touchmove:function(a){a.stopPropagation(),t.dragMove(a)}}}),e("view",{staticClass:"uni-cropper-point point-rb",attrs:{"data-drag":"rightBottom",eventid:"a881305a-6"},on:{touchstart:function(a){a.stopPropagation(),t.dragStart(a)},touchmove:function(a){a.stopPropagation(),t.dragMove(a)}}}),e("view",{staticClass:"uni-cropper-point point-b",attrs:{"data-drag":"bottom",eventid:"a881305a-7"},on:{touchstart:function(a){a.stopPropagation(),t.dragStart(a)},touchmove:function(a){a.stopPropagation(),t.dragMove(a)},touchend:function(a){a.stopPropagation(),t.dragEnd(a)}}}),e("view",{staticClass:"uni-cropper-point point-bl",attrs:{"data-drag":"bottomLeft"}}),e("view",{staticClass:"uni-cropper-point point-l",attrs:{"data-drag":"left",eventid:"a881305a-8"},on:{touchstart:function(a){a.stopPropagation(),t.dragStart(a)},touchmove:function(a){a.stopPropagation(),t.dragMove(a)}}}),e("view",{staticClass:"uni-cropper-point point-lt",attrs:{"data-drag":"leftTop"}})])])])]):t._e()]),e("view",{staticClass:"cropper-config"},[e("button",{staticStyle:{"margin-top":"30rpx"},attrs:{type:"primary reverse",eventid:"a881305a-10"},on:{click:t.getImage}},[t._v("选择图片")]),e("button",{staticStyle:{"margin-top":"30rpx"},attrs:{type:"warn",eventid:"a881305a-11"},on:{click:t.getImageInfo}},[t._v("点击生成图片")])],1),e("canvas",{style:"position:absolute;border: 1px solid red; width:"+t.imageW+"px;height:"+t.imageH+"px;top:-9999px;left:-9999px;",attrs:{"canvas-id":"myCanvas"}})]),e("page-foot",{attrs:{name:t.name,mpcomid:"a881305a-0"}})],1)},i=[];e.d(a,"a",function(){return o}),e.d(a,"b",function(){return i})},"69dc":function(t,a,e){},a64d:function(t,a,e){"use strict";e("0055");var o=c(e("b0ce")),i=c(e("cec8"));function c(t){return t&&t.__esModule?t:{default:t}}Page((0,o.default)(i.default))},b494:function(t,a,e){"use strict";var o=e("69dc"),i=e.n(o);i.a},cec8:function(t,a,e){"use strict";e.r(a);var o=e("5d3e"),i=e("0e65");for(var c in i)"default"!==c&&function(t){e.d(a,t,function(){return i[t]})}(c);e("b494");var r=e("2877"),n=Object(r["a"])(i["default"],o["a"],o["b"],!1,null,null,null);a["default"]=n.exports},dd7a:function(t,a,e){"use strict";(function(t){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var e,o,i,c,r,n,s,p,u,d,g,h=t.getSystemInfoSync(),l=h.screenWidth,v=(h.pixelRatio,1),f=100,m=h.screenWidth,w={data:function(){return{name:"杨大宝",imageSrc:"https://img-cdn-qiniu.dcloud.net.cn/demo_crop.jpg",isShowImg:!1,cropperInitW:l,cropperInitH:l,cropperW:l,cropperH:l,cropperL:0,cropperT:0,transL:0,transT:0,scaleP:0,imageW:0,imageH:0,cutL:0,cutT:0,cutB:l,cutR:"100%",qualityWidth:m,innerAspectRadio:v}},onLoad:function(t){},mounted:function(){this.loadImage()},methods:{setData:function(t){var a=this;Object.keys(t).forEach(function(e){a.$set(a.$data,e,t[e])})},getImage:function(){var a=this;t.chooseImage({success:function(t){a.setData({imageSrc:t.tempFilePaths[0]}),a.loadImage()}})},loadImage:function(){var a=this;t.showLoading({title:"图片加载中..."}),t.getImageInfo({src:a.imageSrc,success:function(e){u=e.width/e.height,u>=1?(d=l,g=l/u):(d=l*u,g=l);var o=d>g?d:g;if(f=o>f?f:o,u>=1){var i=Math.ceil((l/u-(l/u-f))/2),c=i,r=Math.ceil((l-l+f)/2),n=r;a.setData({cropperW:l,cropperH:l/u,cropperL:Math.ceil((l-l)/2),cropperT:Math.ceil((l-l/u)/2),cutL:r,cutT:i,cutR:n,cutB:c,imageW:d,imageH:g,scaleP:d/l,qualityWidth:m,innerAspectRadio:u})}else{var s=Math.ceil((l*u-l*u)/2),p=s,h=Math.ceil((l-f)/2),v=h;a.setData({cropperW:l*u,cropperH:l,cropperL:Math.ceil((l-l*u)/2),cropperT:Math.ceil((l-l)/2),cutL:s,cutT:h,cutR:p,cutB:v,imageW:d,imageH:g,scaleP:d/l,qualityWidth:m,innerAspectRadio:u})}a.setData({isShowImg:!0}),t.hideLoading()}})},contentStartMove:function(t){e=t.touches[0].pageX,o=t.touches[0].pageY},contentMoveing:function(t){var a=(e-t.touches[0].pageX)*v,i=(o-t.touches[0].pageY)*v;a>0?this.cutL-a<0&&(a=this.cutL):this.cutR+a<0&&(a=-this.cutR),i>0?this.cutT-i<0&&(i=this.cutT):this.cutB+i<0&&(i=-this.cutB),this.setData({cutL:this.cutL-a,cutT:this.cutT-i,cutR:this.cutR+a,cutB:this.cutB+i}),e=t.touches[0].pageX,o=t.touches[0].pageY},contentTouchEnd:function(){},getImageInfo:function(){var a=this;t.showLoading({title:"图片生成中..."});var e=t.createCanvasContext("myCanvas");e.drawImage(a.imageSrc,0,0,d,g),e.draw(!0,function(){var e=(a.cropperW-a.cutL-a.cutR)/a.cropperW*d,o=(a.cropperH-a.cutT-a.cutB)/a.cropperH*g,i=a.cutL/a.cropperW*d,c=a.cutT/a.cropperH*g;t.canvasToTempFilePath({x:i,y:c,width:e,height:o,destWidth:e,destHeight:o,quality:.5,canvasId:"myCanvas",success:function(a){t.hideLoading(),t.previewImage({current:"",urls:[a.tempFilePath]})}})})},dragStart:function(t){i=t.touches[0].pageX,c=t.touches[0].pageY,r=this.cutL,s=this.cutR,p=this.cutB,n=this.cutT},dragMove:function(t){var a=t.target.dataset.drag;switch(a){case"right":var e=(i-t.touches[0].pageX)*v;s+e<0&&(e=-s),this.setData({cutR:s+e});break;case"left":e=(i-t.touches[0].pageX)*v;r-e<0&&(e=r),r-e>this.cropperW-this.cutR&&(e=r-(this.cropperW-this.cutR)),this.setData({cutL:r-e});break;case"top":e=(c-t.touches[0].pageY)*v;n-e<0&&(e=n),n-e>this.cropperH-this.cutB&&(e=n-(this.cropperH-this.cutB)),this.setData({cutT:n-e});break;case"bottom":e=(c-t.touches[0].pageY)*v;p+e<0&&(e=-p),this.setData({cutB:p+e});break;case"rightBottom":var o=(i-t.touches[0].pageX)*v,u=(c-t.touches[0].pageY)*v;p+u<0&&(u=-p),s+o<0&&(o=-s);var d=p+u,g=s+o;this.setData({cutB:d,cutR:g});break;default:break}}}};a.default=w}).call(this,e("543d")["default"])}},[["a64d","common/runtime","common/vendor"]]]);